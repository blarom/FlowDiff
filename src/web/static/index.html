<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowDiff - Function Call Tree</title>
    <link rel="stylesheet" href="/static/colors.css">
    <link rel="stylesheet" href="/static/tree.css">

    <!-- Diff2HTML for syntax-highlighted diffs -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css">
    <script src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js"></script>
</head>
<body>
    <!-- Saved Report Banner -->
    <div id="saved-report-banner" class="saved-report-banner hidden">
        <span>ðŸ“„ Saved report: <a id="saved-report-link" href="#" target="_blank"></a></span>
        <button id="close-banner" class="close-banner-btn">&times;</button>
    </div>

    <div class="container">
        <header>
            <h1>FlowDiff</h1>

            <!-- Theme Toggle -->
            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark/light mode">
                <svg class="theme-icon theme-icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
                <svg class="theme-icon theme-icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
            </button>

            <div class="header-info">
                <div class="header-row">
                    <span class="header-label">Run dir:</span>
                    <span id="run-dir" class="header-value"></span>
                </div>
                <div class="header-row">
                    <span class="header-label">Analysis:</span>
                    <span id="analysis-info" class="header-value"></span>
                </div>
            </div>
        </header>

        <div class="controls">
            <div class="controls-row">
                <button id="expand-all">Expand All</button>
                <button id="collapse-all">Collapse All</button>
                <button id="show-diff" class="diff-btn">Show Diff</button>
                <input type="text" id="search" placeholder="Find by regex..." />
            </div>
            <div class="controls-row filter-row">
                <span class="filter-section-label">Filters:</span>
                <div class="filter-group">
                    <label class="filter-label">Include</label>
                    <input type="text" id="filter-include-regex" class="filter-input" placeholder="Enter regex to include..." title="Include nodes matching this regex" />
                    <label class="filter-checkbox-label">
                        <input type="checkbox" id="filter-include-top-level" />
                        <span>Top-level only</span>
                    </label>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Exclude</label>
                    <input type="text" id="filter-exclude-regex" class="filter-input" placeholder="Enter regex to exclude..." title="Exclude nodes matching this regex" />
                    <label class="filter-checkbox-label">
                        <input type="checkbox" id="filter-exclude-top-level" />
                        <span>Top-level only</span>
                    </label>
                </div>
            </div>
        </div>

        <main>
            <div class="tree-container">
                <div id="call-tree" class="call-tree"></div>
            </div>
        </main>
    </div>

    <!-- Diff Selection Modal -->
    <div id="diff-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Select Diff Versions</h2>
                <button id="close-diff-modal" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="diff-before">Before (baseline):</label>
                    <select id="diff-before" class="form-control">
                        <option value="HEAD">HEAD (current commit)</option>
                        <option value="HEAD~1">HEAD~1 (previous commit)</option>
                        <option value="HEAD~2">HEAD~2 (2 commits ago)</option>
                    </select>
                    <input type="text" id="diff-before-custom" placeholder="Or enter custom ref (e.g., main, abc123)" class="form-control" style="margin-top: 10px;">
                </div>
                <div class="form-group">
                    <label for="diff-after">After (comparison):</label>
                    <select id="diff-after" class="form-control">
                        <option value="working">Working Directory (uncommitted changes)</option>
                        <option value="HEAD">HEAD (current commit)</option>
                        <option value="HEAD~1">HEAD~1 (previous commit)</option>
                    </select>
                    <input type="text" id="diff-after-custom" placeholder="Or enter custom ref (e.g., feature-branch)" class="form-control" style="margin-top: 10px;">
                </div>
                <div class="modal-footer">
                    <button id="cancel-diff" class="btn-secondary">Cancel</button>
                    <button id="load-diff" class="btn-primary">Load Diff</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Info Panel Overlay (for click-outside-to-close) -->
    <div id="info-panel-overlay" class="info-panel-overlay"></div>

    <!-- Info Panel (modal/side panel) -->
    <div id="info-panel" class="info-panel hidden">
        <div class="info-panel-header">
            <h2 id="info-title">Function Info</h2>
            <button id="close-info" class="close-btn">&times;</button>
        </div>
        <div class="info-panel-content">
            <div class="info-section">
                <h3>Location</h3>
                <div id="info-location"></div>
            </div>
            <div class="info-section">
                <h3>Signature</h3>
                <div id="info-signature"></div>
            </div>
            <div class="info-section">
                <h3>Parameters</h3>
                <div id="info-parameters"></div>
            </div>
            <div class="info-section">
                <h3>Documentation</h3>
                <div id="info-documentation"></div>
            </div>
            <div class="info-section">
                <h3>Local Variables</h3>
                <div id="info-locals"></div>
            </div>
            <div class="info-section">
                <h3>Calls</h3>
                <div id="info-calls"></div>
            </div>
            <div class="info-section">
                <h3>Called By</h3>
                <div id="info-called-by"></div>
            </div>
        </div>
    </div>

    <script src="/static/theme.js"></script>
    <script src="/static/tree.js"></script>
</body>
</html>
